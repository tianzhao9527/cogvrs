# ğŸ˜ï¸ Cogvrs éƒ¨è½æ‰©å±•è®¾è®¡æ–¹æ¡ˆ

> ä»ä¸ªä½“æ™ºèƒ½ä½“åˆ°éƒ¨è½é›†ç¾¤ï¼Œå†åˆ°å¤šéƒ¨è½å®è§‚æ–‡æ˜æ¨¡æ‹Ÿçš„å®Œæ•´æ‰©å±•æ¶æ„

![Version](https://img.shields.io/badge/expansion-tribal--system-green)
![Stage](https://img.shields.io/badge/stage-design--phase-blue)
![Complexity](https://img.shields.io/badge/complexity-multi--scale-orange)

---

## ğŸ¯ æ‰©å±•ç›®æ ‡ä¸æ„¿æ™¯

### ğŸ“‹ æ€»ä½“ç›®æ ‡
1. **ä¸ªä½“èšåˆ**: å°†ç°æœ‰ä¸ªä½“æ™ºèƒ½ä½“è‡ªç„¶èšåˆæˆéƒ¨è½å•ä½
2. **éƒ¨è½æ™ºèƒ½**: å¼€å‘éƒ¨è½çº§åˆ«çš„é›†ä½“å†³ç­–å’Œè¡Œä¸ºç³»ç»Ÿ
3. **å®è§‚æ¨¡æ‹Ÿ**: å®ç°å¤šéƒ¨è½é—´çš„å¤æ‚äº¤äº’å’Œæ–‡æ˜æ¼”åŒ–
4. **å±‚æ¬¡åŒ–ç®¡ç†**: å»ºç«‹ä¸ªä½“â†’éƒ¨è½â†’æ–‡æ˜çš„å¤šå±‚æ¬¡æ¶æ„

### ğŸŒŸ æ„¿æ™¯é˜¶æ®µ
```
é˜¶æ®µ1: éƒ¨è½å½¢æˆ (Individual â†’ Tribe)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ ğŸ‘¤ ğŸ‘¤ â†’ ğŸ˜ï¸ å°å‹éƒ¨è½ (5-15äºº)    â”‚
â”‚  è‡ªç„¶èšé›†    åŸºç¡€åˆä½œ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ2: éƒ¨è½å‘å±• (Tribe Growth)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ˜ï¸ â†’ ğŸ˜ï¸+ ä¸­å‹éƒ¨è½ (15-50äºº)       â”‚
â”‚  ä¸“ä¸šåˆ†å·¥    å¤æ‚ç¤¾ä¼šç»“æ„             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ3: å¤šéƒ¨è½äº’åŠ¨ (Inter-Tribal)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ˜ï¸ â†â†’ ğŸ˜ï¸ éƒ¨è½é—´äº¤äº’               â”‚
â”‚  è´¸æ˜“  æˆ˜äº‰  è”ç›Ÿ  ç«äº‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ4: æ–‡æ˜æ¶Œç° (Civilization)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ˜ï¸ğŸ˜ï¸ğŸ˜ï¸ â†’ ğŸ›ï¸ æ–‡æ˜ä½“               â”‚
â”‚  æ”¿æ²»ç»“æ„    æŠ€æœ¯ä¼ æ’­    æ–‡åŒ–æ¼”åŒ–     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡æ–¹æ¡ˆ

### ğŸ”„ 1. æ¸è¿›å¼æ‰©å±•ç­–ç•¥ (æ¨è)

æˆ‘å»ºè®®é‡‡ç”¨**æ¸è¿›å¼å¤šå±‚æ¶æ„**ï¼ŒåŸå› å¦‚ä¸‹ï¼š

#### âœ… ä¼˜åŠ¿
- **å¹³æ»‘è¿‡æ¸¡**: ç°æœ‰ç³»ç»Ÿæ— éœ€å¤§å¹…æ”¹åŠ¨
- **çµæ´»åˆ‡æ¢**: å¯ä»¥åœ¨ä¸åŒæŠ½è±¡å±‚æ¬¡é—´åŠ¨æ€åˆ‡æ¢
- **è°ƒè¯•å‹å¥½**: æ¯ä¸ªå±‚æ¬¡éƒ½å¯ä»¥ç‹¬ç«‹è§‚å¯Ÿå’Œè°ƒè¯•
- **è®¡ç®—æ•ˆç‡**: æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„ä»¿çœŸç²’åº¦

#### ğŸ›ï¸ å¤šå±‚æ¶æ„è®¾è®¡

```python
class MultiScaleSimulation:
    """å¤šå°ºåº¦ä»¿çœŸç³»ç»Ÿ"""
    
    def __init__(self):
        # ä¸‰ä¸ªæŠ½è±¡å±‚æ¬¡
        self.individual_layer = IndividualSimulation()    # ä¸ªä½“å±‚
        self.tribal_layer = TribalSimulation()           # éƒ¨è½å±‚  
        self.civilization_layer = CivilizationSimulation() # æ–‡æ˜å±‚
        
        # å½“å‰æ¿€æ´»çš„å±‚æ¬¡
        self.active_layers = ['individual']  # å¼€å§‹åªæœ‰ä¸ªä½“å±‚
        self.scale_threshold = {
            'tribal_formation': 5,        # 5ä¸ªäººå½¢æˆéƒ¨è½
            'civilization_emergence': 3   # 3ä¸ªéƒ¨è½å½¢æˆæ–‡æ˜
        }
    
    def update(self, dt: float):
        """å¤šå±‚æ¬¡æ›´æ–°"""
        # 1. ä¸ªä½“å±‚æ›´æ–°ï¼ˆå¦‚æœæ¿€æ´»ï¼‰
        if 'individual' in self.active_layers:
            self.individual_layer.update(dt)
            
            # æ£€æŸ¥æ˜¯å¦éœ€è¦æ¿€æ´»éƒ¨è½å±‚
            if self._should_activate_tribal_layer():
                self._activate_tribal_layer()
        
        # 2. éƒ¨è½å±‚æ›´æ–°ï¼ˆå¦‚æœæ¿€æ´»ï¼‰
        if 'tribal' in self.active_layers:
            self.tribal_layer.update(dt)
            
            # æ£€æŸ¥æ˜¯å¦éœ€è¦æ¿€æ´»æ–‡æ˜å±‚
            if self._should_activate_civilization_layer():
                self._activate_civilization_layer()
        
        # 3. æ–‡æ˜å±‚æ›´æ–°ï¼ˆå¦‚æœæ¿€æ´»ï¼‰
        if 'civilization' in self.active_layers:
            self.civilization_layer.update(dt)
    
    def _should_activate_tribal_layer(self) -> bool:
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥æ¿€æ´»éƒ¨è½å±‚"""
        # å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ä¸ªä½“èšé›†æ—¶
        clusters = self.individual_layer.detect_agent_clusters()
        large_clusters = [c for c in clusters if len(c) >= self.scale_threshold['tribal_formation']]
        return len(large_clusters) > 0
```

---

## ğŸ˜ï¸ éƒ¨è½ç³»ç»Ÿè®¾è®¡

### ğŸ§¬ 1. éƒ¨è½å½¢æˆæœºåˆ¶

#### **è‡ªç„¶èšåˆç®—æ³•**
```python
class TribalFormation:
    """éƒ¨è½è‡ªç„¶å½¢æˆç³»ç»Ÿ"""
    
    def __init__(self):
        self.formation_criteria = {
            'spatial_proximity': 20.0,      # ç©ºé—´è·ç¦»é˜ˆå€¼
            'social_affinity': 0.6,         # ç¤¾äº¤äº²å’Œåº¦é˜ˆå€¼
            'resource_sharing': 0.7,        # èµ„æºå…±äº«æ„æ„¿
            'cooperation_history': 0.5,     # åˆä½œå†å²åˆ†æ•°
            'min_tribe_size': 5,            # æœ€å°éƒ¨è½è§„æ¨¡
            'max_tribe_size': 50            # æœ€å¤§éƒ¨è½è§„æ¨¡
        }
    
    def detect_potential_tribes(self, agents: List[SimpleAgent]) -> List[List[SimpleAgent]]:
        """æ£€æµ‹æ½œåœ¨çš„éƒ¨è½å½¢æˆ"""
        potential_tribes = []
        unassigned_agents = agents.copy()
        
        while len(unassigned_agents) >= self.formation_criteria['min_tribe_size']:
            # å¯»æ‰¾ç§å­æ™ºèƒ½ä½“ï¼ˆæœ€å…·é¢†å¯¼åŠ›çš„ï¼‰
            seed_agent = self._find_leadership_candidate(unassigned_agents)
            if not seed_agent:
                break
            
            # åŸºäºç§å­æ™ºèƒ½ä½“å½¢æˆéƒ¨è½
            tribe_members = self._form_tribe_around_seed(seed_agent, unassigned_agents)
            
            if len(tribe_members) >= self.formation_criteria['min_tribe_size']:
                potential_tribes.append(tribe_members)
                for member in tribe_members:
                    unassigned_agents.remove(member)
            else:
                break
        
        return potential_tribes
    
    def _find_leadership_candidate(self, agents: List[SimpleAgent]) -> SimpleAgent:
        """å¯»æ‰¾é¢†å¯¼åŠ›å€™é€‰è€…"""
        leadership_scores = {}
        
        for agent in agents:
            score = 0
            
            # ç¤¾äº¤æ´»è·ƒåº¦
            score += agent.social_interactions / 100.0
            
            # ç”Ÿå­˜èƒ½åŠ›ï¼ˆå¹´é¾„ã€å¥åº·ï¼‰
            score += (agent.age / 200.0) * 0.5
            score += (agent.health / 100.0) * 0.3
            
            # èµ„æºè·å–èƒ½åŠ›
            score += (agent.energy / agent.max_energy) * 0.4
            
            # ä¸ªæ€§ç‰¹å¾ï¼ˆé¢†å¯¼å€¾å‘ï¼‰
            if hasattr(agent, 'behavior_system'):
                personality = agent.behavior_system.behavior_preferences
                score += personality.get('social_activity', 0) * 0.6
                score += personality.get('cooperation', 0) * 0.4
            
            leadership_scores[agent] = score
        
        return max(leadership_scores.items(), key=lambda x: x[1])[0] if leadership_scores else None
    
    def _form_tribe_around_seed(self, seed_agent: SimpleAgent, 
                               available_agents: List[SimpleAgent]) -> List[SimpleAgent]:
        """å›´ç»•ç§å­æ™ºèƒ½ä½“å½¢æˆéƒ¨è½"""
        tribe_members = [seed_agent]
        candidates = [a for a in available_agents if a != seed_agent]
        
        # æ ¹æ®äº²å’Œåº¦æ’åºå€™é€‰è€…
        affinity_scores = []
        for candidate in candidates:
            affinity = self._calculate_affinity(seed_agent, candidate)
            affinity_scores.append((candidate, affinity))
        
        # æŒ‰äº²å’Œåº¦æ’åº
        affinity_scores.sort(key=lambda x: x[1], reverse=True)
        
        # é€‰æ‹©æœ€äº²å’Œçš„æ™ºèƒ½ä½“åŠ å…¥éƒ¨è½
        for candidate, affinity in affinity_scores:
            if (len(tribe_members) < self.formation_criteria['max_tribe_size'] and
                affinity > self.formation_criteria['social_affinity']):
                
                # æ£€æŸ¥ç©ºé—´è·ç¦»
                distance = seed_agent.position.distance_to(candidate.position)
                if distance <= self.formation_criteria['spatial_proximity']:
                    tribe_members.append(candidate)
        
        return tribe_members
    
    def _calculate_affinity(self, agent1: SimpleAgent, agent2: SimpleAgent) -> float:
        """è®¡ç®—ä¸¤ä¸ªæ™ºèƒ½ä½“çš„äº²å’Œåº¦"""
        affinity = 0.0
        
        # ä¸ªæ€§ç›¸ä¼¼åº¦
        if (hasattr(agent1, 'behavior_system') and 
            hasattr(agent2, 'behavior_system')):
            
            prefs1 = agent1.behavior_system.behavior_preferences
            prefs2 = agent2.behavior_system.behavior_preferences
            
            similarity = 0
            for trait in prefs1:
                if trait in prefs2:
                    similarity += 1 - abs(prefs1[trait] - prefs2[trait])
            
            affinity += similarity / len(prefs1)
        
        # å¹´é¾„ç›¸è¿‘åº¦
        age_similarity = 1 - abs(agent1.age - agent2.age) / 200.0
        affinity += age_similarity * 0.3
        
        # èƒ½é‡æ°´å¹³ç›¸ä¼¼åº¦
        energy_diff = abs(agent1.energy - agent2.energy) / max(agent1.max_energy, agent2.max_energy)
        energy_similarity = 1 - energy_diff
        affinity += energy_similarity * 0.2
        
        return affinity / 1.5  # å½’ä¸€åŒ–
```

### ğŸ­ 2. éƒ¨è½æ™ºèƒ½ä½“è®¾è®¡

#### **Tribeç±»æ¶æ„**
```python
class Tribe:
    """éƒ¨è½æ™ºèƒ½ä½“ç±»"""
    
    def __init__(self, members: List[SimpleAgent], leader: SimpleAgent):
        self.tribe_id = f"tribe_{int(time.time())}_{random.randint(1000, 9999)}"
        self.members = members
        self.leader = leader
        self.creation_time = time.time()
        
        # éƒ¨è½å±æ€§
        self.territory_center = self._calculate_territory_center()
        self.territory_radius = self._calculate_territory_radius()
        self.resources = TribalResources()
        self.culture = TribalCulture()
        self.technology = TribalTechnology()
        
        # éƒ¨è½ç»Ÿè®¡
        self.population = len(members)
        self.avg_age = sum(m.age for m in members) / len(members)
        self.total_energy = sum(m.energy for m in members)
        self.total_health = sum(m.health for m in members)
        
        # éƒ¨è½è¡Œä¸ºç³»ç»Ÿ
        self.tribal_behavior = TribalBehaviorSystem()
        self.decision_maker = CollectiveDecisionMaker(members, leader)
        
        # éƒ¨è½å…³ç³»
        self.allies = []        # ç›Ÿå‹éƒ¨è½
        self.enemies = []       # æ•Œå¯¹éƒ¨è½
        self.trade_partners = [] # è´¸æ˜“ä¼™ä¼´
        
        # ä¸“ä¸šåˆ†å·¥
        self.roles = self._assign_tribal_roles()
        
    def update(self, dt: float, world_state: Dict):
        """éƒ¨è½æ›´æ–°å¾ªç¯"""
        # 1. æ›´æ–°ä¸ªä½“æˆå‘˜
        self._update_members(dt, world_state)
        
        # 2. é›†ä½“å†³ç­–
        tribal_decision = self.decision_maker.make_collective_decision(world_state)
        
        # 3. æ‰§è¡Œéƒ¨è½è¡ŒåŠ¨
        self._execute_tribal_action(tribal_decision)
        
        # 4. æ›´æ–°éƒ¨è½çŠ¶æ€
        self._update_tribal_state()
        
        # 5. å¤„ç†æˆå‘˜å˜åŒ–
        self._handle_membership_changes()
    
    def _assign_tribal_roles(self) -> Dict[str, List[SimpleAgent]]:
        """åˆ†é…éƒ¨è½è§’è‰²"""
        roles = {
            'leader': [self.leader],
            'hunters': [],
            'gatherers': [],
            'defenders': [],
            'caretakers': [],
            'scouts': []
        }
        
        # åŸºäºä¸ªæ€§ç‰¹å¾åˆ†é…è§’è‰²
        for member in self.members:
            if member == self.leader:
                continue
                
            if hasattr(member, 'behavior_system'):
                prefs = member.behavior_system.behavior_preferences
                
                # æ ¹æ®ä¸ªæ€§åˆ†é…æœ€é€‚åˆçš„è§’è‰²
                role_scores = {
                    'hunters': prefs.get('aggression', 0) + prefs.get('risk_taking', 0),
                    'gatherers': prefs.get('exploration', 0) + prefs.get('curiosity', 0),
                    'defenders': prefs.get('aggression', 0) + (1 - prefs.get('risk_taking', 0.5)),
                    'caretakers': prefs.get('cooperation', 0) + (1 - prefs.get('aggression', 0.5)),
                    'scouts': prefs.get('exploration', 0) + prefs.get('risk_taking', 0)
                }
                
                best_role = max(role_scores.items(), key=lambda x: x[1])[0]
                roles[best_role].append(member)
        
        return roles
    
    def _calculate_territory_center(self) -> Vector2D:
        """è®¡ç®—éƒ¨è½é¢†åœŸä¸­å¿ƒ"""
        total_x = sum(member.position.x for member in self.members)
        total_y = sum(member.position.y for member in self.members)
        
        return Vector2D(total_x / len(self.members), total_y / len(self.members))
    
    def _calculate_territory_radius(self) -> float:
        """è®¡ç®—éƒ¨è½é¢†åœŸåŠå¾„"""
        center = self.territory_center
        max_distance = 0
        
        for member in self.members:
            distance = center.distance_to(member.position)
            max_distance = max(max_distance, distance)
        
        # é¢†åœŸåŠå¾„ = æœ€è¿œæˆå‘˜è·ç¦» Ã— 1.5 + åŸºç¡€ç¼“å†²
        return max_distance * 1.5 + 20.0
```

#### **é›†ä½“å†³ç­–ç³»ç»Ÿ**
```python
class CollectiveDecisionMaker:
    """é›†ä½“å†³ç­–åˆ¶å®šç³»ç»Ÿ"""
    
    def __init__(self, members: List[SimpleAgent], leader: SimpleAgent):
        self.members = members
        self.leader = leader
        self.decision_history = []
        
        # å†³ç­–æ¨¡å¼
        self.decision_modes = {
            'autocratic': 0.3,      # ç‹¬è£å¼ï¼ˆé¢†å¯¼è€…å†³å®šï¼‰
            'democratic': 0.4,      # æ°‘ä¸»å¼ï¼ˆæŠ•ç¥¨å†³å®šï¼‰
            'consensus': 0.2,       # å…±è¯†å¼ï¼ˆä¸€è‡´åŒæ„ï¼‰
            'expertise': 0.1        # ä¸“å®¶å¼ï¼ˆæœ€æœ‰ç»éªŒè€…å†³å®šï¼‰
        }
    
    def make_collective_decision(self, world_state: Dict) -> TribalAction:
        """åˆ¶å®šé›†ä½“å†³ç­–"""
        
        # 1. è¯†åˆ«å½“å‰é¢ä¸´çš„ä¸»è¦é—®é¢˜
        problems = self._identify_problems(world_state)
        
        if not problems:
            return TribalAction(TribalActionType.MAINTAIN, priority=0.1)
        
        # 2. é€‰æ‹©æœ€é‡è¦çš„é—®é¢˜
        primary_problem = max(problems.items(), key=lambda x: x[1])[0]
        
        # 3. ç”Ÿæˆè§£å†³æ–¹æ¡ˆ
        solutions = self._generate_solutions(primary_problem, world_state)
        
        # 4. é€‰æ‹©å†³ç­–æ¨¡å¼
        decision_mode = self._select_decision_mode(primary_problem)
        
        # 5. æ ¹æ®å†³ç­–æ¨¡å¼é€‰æ‹©æœ€ä½³æ–¹æ¡ˆ
        chosen_solution = self._choose_solution(solutions, decision_mode)
        
        # 6. è®°å½•å†³ç­–
        decision_record = {
            'timestamp': time.time(),
            'problem': primary_problem,
            'solutions_considered': len(solutions),
            'decision_mode': decision_mode,
            'chosen_solution': chosen_solution
        }
        self.decision_history.append(decision_record)
        
        return chosen_solution
    
    def _identify_problems(self, world_state: Dict) -> Dict[str, float]:
        """è¯†åˆ«å½“å‰é¢ä¸´çš„é—®é¢˜"""
        problems = {}
        
        # èµ„æºçŸ­ç¼ºé—®é¢˜
        avg_energy = sum(m.energy for m in self.members) / len(self.members)
        if avg_energy < 40:
            problems['resource_shortage'] = 1.0 - (avg_energy / 100.0)
        
        # å¥åº·å±æœº
        avg_health = sum(m.health for m in self.members) / len(self.members)
        if avg_health < 60:
            problems['health_crisis'] = 1.0 - (avg_health / 100.0)
        
        # äººå£é—®é¢˜
        if len(self.members) < 3:
            problems['population_decline'] = 1.0 - (len(self.members) / 10.0)
        elif len(self.members) > 30:
            problems['overpopulation'] = (len(self.members) - 30) / 20.0
        
        # é¢†åœŸå¨èƒ
        nearby_tribes = world_state.get('nearby_tribes', [])
        hostile_tribes = [t for t in nearby_tribes if self._is_hostile(t)]
        if hostile_tribes:
            problems['territorial_threat'] = len(hostile_tribes) / 5.0
        
        return problems
    
    def _generate_solutions(self, problem: str, world_state: Dict) -> List[TribalAction]:
        """ä¸ºé—®é¢˜ç”Ÿæˆè§£å†³æ–¹æ¡ˆ"""
        solutions = []
        
        if problem == 'resource_shortage':
            solutions.extend([
                TribalAction(TribalActionType.FORAGE, priority=0.8),
                TribalAction(TribalActionType.MIGRATE, priority=0.6),
                TribalAction(TribalActionType.TRADE, priority=0.7),
                TribalAction(TribalActionType.RAID, priority=0.4)
            ])
        
        elif problem == 'health_crisis':
            solutions.extend([
                TribalAction(TribalActionType.REST, priority=0.9),
                TribalAction(TribalActionType.SEEK_MEDICINE, priority=0.7),
                TribalAction(TribalActionType.ISOLATE_SICK, priority=0.6)
            ])
        
        elif problem == 'population_decline':
            solutions.extend([
                TribalAction(TribalActionType.ENCOURAGE_REPRODUCTION, priority=0.8),
                TribalAction(TribalActionType.RECRUIT_OUTSIDERS, priority=0.6),
                TribalAction(TribalActionType.MERGE_WITH_ALLY, priority=0.5)
            ])
        
        elif problem == 'territorial_threat':
            solutions.extend([
                TribalAction(TribalActionType.FORTIFY_TERRITORY, priority=0.7),
                TribalAction(TribalActionType.FORM_ALLIANCE, priority=0.8),
                TribalAction(TribalActionType.PREEMPTIVE_ATTACK, priority=0.4),
                TribalAction(TribalActionType.MIGRATE, priority=0.6)
            ])
        
        return solutions
    
    def _choose_solution(self, solutions: List[TribalAction], decision_mode: str) -> TribalAction:
        """æ ¹æ®å†³ç­–æ¨¡å¼é€‰æ‹©è§£å†³æ–¹æ¡ˆ"""
        
        if decision_mode == 'autocratic':
            # é¢†å¯¼è€…åå¥½å†³å®š
            leader_personality = self.leader.behavior_system.behavior_preferences
            
            for solution in solutions:
                # æ ¹æ®é¢†å¯¼è€…ä¸ªæ€§è°ƒæ•´æ–¹æ¡ˆä¼˜å…ˆçº§
                if solution.type == TribalActionType.RAID and leader_personality.get('aggression', 0) > 0.7:
                    solution.priority *= 1.5
                elif solution.type == TribalActionType.TRADE and leader_personality.get('cooperation', 0) > 0.7:
                    solution.priority *= 1.3
            
            return max(solutions, key=lambda s: s.priority)
        
        elif decision_mode == 'democratic':
            # æŠ•ç¥¨å†³å®š
            votes = {}
            for solution in solutions:
                votes[solution] = 0
                
                for member in self.members:
                    member_vote = self._member_vote_for_solution(member, solution)
                    votes[solution] += member_vote
            
            return max(votes.items(), key=lambda x: x[1])[0]
        
        elif decision_mode == 'consensus':
            # å¯»æ‰¾æ‰€æœ‰äººéƒ½èƒ½æ¥å—çš„æ–¹æ¡ˆ
            acceptable_solutions = []
            
            for solution in solutions:
                all_accept = True
                for member in self.members:
                    if self._member_vote_for_solution(member, solution) < 0.5:
                        all_accept = False
                        break
                
                if all_accept:
                    acceptable_solutions.append(solution)
            
            if acceptable_solutions:
                return max(acceptable_solutions, key=lambda s: s.priority)
            else:
                # å¦‚æœæ²¡æœ‰å…±è¯†ï¼Œé€€å›åˆ°æ°‘ä¸»æŠ•ç¥¨
                return self._choose_solution(solutions, 'democratic')
        
        else:  # expertise
            # é€‰æ‹©æœ€æœ‰ç»éªŒçš„æˆå‘˜çš„åå¥½
            most_experienced = max(self.members, key=lambda m: m.age)
            expert_choice = max(solutions, key=lambda s: self._member_vote_for_solution(most_experienced, s))
            return expert_choice
```

---

## ğŸŒ å¤šéƒ¨è½å®è§‚ç³»ç»Ÿ

### ğŸ—ºï¸ 1. éƒ¨è½é—´äº¤äº’ç³»ç»Ÿ

#### **éƒ¨è½å…³ç³»åŠ¨æ€**
```python
class InterTribalRelations:
    """éƒ¨è½é—´å…³ç³»ç®¡ç†ç³»ç»Ÿ"""
    
    def __init__(self):
        self.relationship_matrix = {}  # (tribe1_id, tribe2_id) -> relationship_score
        self.interaction_history = []
        self.territorial_disputes = []
        self.trade_routes = []
        self.alliances = []
        
        # å…³ç³»ç±»å‹å®šä¹‰
        self.relationship_types = {
            'hostile': (-1.0, -0.6),      # æ•Œå¯¹
            'unfriendly': (-0.6, -0.2),   # ä¸å‹å¥½
            'neutral': (-0.2, 0.2),       # ä¸­æ€§
            'friendly': (0.2, 0.6),       # å‹å¥½
            'allied': (0.6, 1.0)          # åŒç›Ÿ
        }
    
    def update_tribal_relations(self, tribes: List[Tribe], dt: float):
        """æ›´æ–°éƒ¨è½é—´å…³ç³»"""
        
        for i, tribe1 in enumerate(tribes):
            for tribe2 in tribes[i+1:]:
                # è®¡ç®—éƒ¨è½é—´è·ç¦»
                distance = tribe1.territory_center.distance_to(tribe2.territory_center)
                
                # æ£€æŸ¥æ˜¯å¦åœ¨äº¤äº’èŒƒå›´å†…
                interaction_range = tribe1.territory_radius + tribe2.territory_radius + 50
                
                if distance <= interaction_range:
                    # å¤„ç†éƒ¨è½é—´äº¤äº’
                    self._process_tribal_interaction(tribe1, tribe2, distance)
    
    def _process_tribal_interaction(self, tribe1: Tribe, tribe2: Tribe, distance: float):
        """å¤„ç†ä¸¤ä¸ªéƒ¨è½é—´çš„äº¤äº’"""
        
        # è·å–å½“å‰å…³ç³»çŠ¶æ€
        current_relationship = self._get_relationship_score(tribe1.tribe_id, tribe2.tribe_id)
        
        # æ£€æµ‹äº¤äº’ç±»å‹
        interaction_type = self._determine_interaction_type(tribe1, tribe2, current_relationship)
        
        # æ‰§è¡Œäº¤äº’
        if interaction_type == 'trade':
            self._handle_trade_interaction(tribe1, tribe2)
        elif interaction_type == 'territorial_dispute':
            self._handle_territorial_dispute(tribe1, tribe2)
        elif interaction_type == 'alliance_formation':
            self._handle_alliance_formation(tribe1, tribe2)
        elif interaction_type == 'conflict':
            self._handle_tribal_conflict(tribe1, tribe2)
        elif interaction_type == 'cultural_exchange':
            self._handle_cultural_exchange(tribe1, tribe2)
    
    def _determine_interaction_type(self, tribe1: Tribe, tribe2: Tribe, relationship: float) -> str:
        """ç¡®å®šäº¤äº’ç±»å‹"""
        
        # åŸºäºå…³ç³»çŠ¶æ€å’Œéƒ¨è½ç‰¹å¾å†³å®šäº¤äº’ç±»å‹
        tribe1_aggression = tribe1.leader.behavior_system.behavior_preferences.get('aggression', 0.3)
        tribe2_aggression = tribe2.leader.behavior_system.behavior_preferences.get('aggression', 0.3)
        
        # èµ„æºçŠ¶å†µå½±å“
        tribe1_resources = tribe1.total_energy / len(tribe1.members)
        tribe2_resources = tribe2.total_energy / len(tribe2.members)
        
        # å†³ç­–é€»è¾‘
        if relationship < -0.5 or (tribe1_aggression > 0.7 and tribe1_resources < 30):
            return 'conflict'
        elif relationship > 0.5 and abs(tribe1_resources - tribe2_resources) < 20:
            return 'alliance_formation'
        elif relationship > 0.0 and tribe1_resources > 50 and tribe2_resources > 50:
            return 'trade'
        elif abs(tribe1.territory_center.distance_to(tribe2.territory_center)) < max(tribe1.territory_radius, tribe2.territory_radius):
            return 'territorial_dispute'
        else:
            return 'cultural_exchange'
    
    def _handle_trade_interaction(self, tribe1: Tribe, tribe2: Tribe):
        """å¤„ç†è´¸æ˜“äº¤äº’"""
        
        # è®¡ç®—è´¸æ˜“æ”¶ç›Š
        trade_benefit = min(tribe1.total_energy * 0.1, tribe2.total_energy * 0.1)
        
        # èµ„æºäº¤æ¢
        if tribe1.total_energy > tribe2.total_energy:
            # tribe1 ç»™ tribe2 èµ„æº
            self._transfer_resources(tribe1, tribe2, trade_benefit)
        else:
            # tribe2 ç»™ tribe1 èµ„æº
            self._transfer_resources(tribe2, tribe1, trade_benefit)
        
        # æ”¹å–„å…³ç³»
        self._modify_relationship(tribe1.tribe_id, tribe2.tribe_id, +0.1)
        
        # è®°å½•è´¸æ˜“
        trade_record = {
            'timestamp': time.time(),
            'tribe1': tribe1.tribe_id,
            'tribe2': tribe2.tribe_id,
            'type': 'trade',
            'benefit': trade_benefit
        }
        self.interaction_history.append(trade_record)
    
    def _handle_tribal_conflict(self, tribe1: Tribe, tribe2: Tribe):
        """å¤„ç†éƒ¨è½å†²çª"""
        
        # è®¡ç®—æˆ˜æ–—åŠ›
        tribe1_strength = self._calculate_military_strength(tribe1)
        tribe2_strength = self._calculate_military_strength(tribe2)
        
        # æˆ˜æ–—ç»“æœ
        total_strength = tribe1_strength + tribe2_strength
        tribe1_win_probability = tribe1_strength / total_strength
        
        if random.random() < tribe1_win_probability:
            # tribe1 è·èƒœ
            winner, loser = tribe1, tribe2
        else:
            # tribe2 è·èƒœ
            winner, loser = tribe2, tribe1
        
        # åº”ç”¨å†²çªç»“æœ
        self._apply_conflict_results(winner, loser)
        
        # æ¶åŒ–å…³ç³»
        self._modify_relationship(tribe1.tribe_id, tribe2.tribe_id, -0.3)
    
    def _calculate_military_strength(self, tribe: Tribe) -> float:
        """è®¡ç®—éƒ¨è½å†›äº‹å®åŠ›"""
        
        # åŸºç¡€å®åŠ› = äººå£ Ã— å¹³å‡å¥åº· Ã— å¹³å‡èƒ½é‡
        base_strength = len(tribe.members) * (tribe.total_health / len(tribe.members)) * (tribe.total_energy / len(tribe.members))
        
        # é¢†å¯¼åŠ›åŠ æˆ
        leadership_bonus = tribe.leader.behavior_system.behavior_preferences.get('aggression', 0.3) * 0.2
        
        # æˆ˜å£«æ¯”ä¾‹åŠ æˆ
        warriors = tribe.roles.get('defenders', []) + tribe.roles.get('hunters', [])
        warrior_ratio = len(warriors) / len(tribe.members)
        warrior_bonus = warrior_ratio * 0.3
        
        # æŠ€æœ¯æ°´å¹³åŠ æˆï¼ˆå¦‚æœå®ç°äº†æŠ€æœ¯ç³»ç»Ÿï¼‰
        tech_bonus = getattr(tribe.technology, 'military_tech_level', 1.0) * 0.1
        
        total_strength = base_strength * (1 + leadership_bonus + warrior_bonus + tech_bonus)
        
        return total_strength
```

### ğŸ›ï¸ 2. æ–‡æ˜å±‚æ¬¡æ¶Œç°

#### **æ–‡æ˜å½¢æˆæ£€æµ‹**
```python
class CivilizationEmergence:
    """æ–‡æ˜æ¶Œç°æ£€æµ‹å’Œç®¡ç†ç³»ç»Ÿ"""
    
    def __init__(self):
        self.civilizations = []
        self.emergence_criteria = {
            'min_tribes': 3,                    # æœ€å°‘éƒ¨è½æ•°é‡
            'min_total_population': 100,        # æœ€å°‘æ€»äººå£
            'trade_network_density': 0.6,       # è´¸æ˜“ç½‘ç»œå¯†åº¦
            'cultural_similarity': 0.4,         # æ–‡åŒ–ç›¸ä¼¼åº¦
            'territorial_stability': 0.7,       # é¢†åœŸç¨³å®šæ€§
            'technological_advancement': 0.5     # æŠ€æœ¯å‘å±•æ°´å¹³
        }
    
    def detect_civilization_emergence(self, tribes: List[Tribe]) -> List[Civilization]:
        """æ£€æµ‹æ–‡æ˜æ¶Œç°"""
        
        potential_civilizations = []
        
        # å¯»æ‰¾è¿é€šçš„éƒ¨è½ç¾¤
        tribal_clusters = self._find_tribal_clusters(tribes)
        
        for cluster in tribal_clusters:
            if self._meets_civilization_criteria(cluster):
                civilization = self._form_civilization(cluster)
                potential_civilizations.append(civilization)
        
        return potential_civilizations
    
    def _find_tribal_clusters(self, tribes: List[Tribe]) -> List[List[Tribe]]:
        """å¯»æ‰¾è¿é€šçš„éƒ¨è½ç¾¤"""
        clusters = []
        visited = set()
        
        for tribe in tribes:
            if tribe.tribe_id not in visited:
                cluster = self._bfs_tribal_connections(tribe, tribes, visited)
                if len(cluster) >= self.emergence_criteria['min_tribes']:
                    clusters.append(cluster)
        
        return clusters
    
    def _meets_civilization_criteria(self, tribal_cluster: List[Tribe]) -> bool:
        """æ£€æŸ¥æ˜¯å¦æ»¡è¶³æ–‡æ˜å½¢æˆæ¡ä»¶"""
        
        # 1. éƒ¨è½æ•°é‡æ£€æŸ¥
        if len(tribal_cluster) < self.emergence_criteria['min_tribes']:
            return False
        
        # 2. æ€»äººå£æ£€æŸ¥
        total_population = sum(len(tribe.members) for tribe in tribal_cluster)
        if total_population < self.emergence_criteria['min_total_population']:
            return False
        
        # 3. è´¸æ˜“ç½‘ç»œå¯†åº¦æ£€æŸ¥
        trade_density = self._calculate_trade_network_density(tribal_cluster)
        if trade_density < self.emergence_criteria['trade_network_density']:
            return False
        
        # 4. æ–‡åŒ–ç›¸ä¼¼åº¦æ£€æŸ¥
        cultural_similarity = self._calculate_cultural_similarity(tribal_cluster)
        if cultural_similarity < self.emergence_criteria['cultural_similarity']:
            return False
        
        # 5. é¢†åœŸç¨³å®šæ€§æ£€æŸ¥
        territorial_stability = self._calculate_territorial_stability(tribal_cluster)
        if territorial_stability < self.emergence_criteria['territorial_stability']:
            return False
        
        return True
    
    def _form_civilization(self, tribal_cluster: List[Tribe]) -> 'Civilization':
        """å½¢æˆæ–‡æ˜"""
        
        civilization = Civilization(
            founding_tribes=tribal_cluster,
            formation_time=time.time()
        )
        
        # ç¡®å®šæ–‡æ˜ä¸­å¿ƒ
        civilization.capital = self._determine_civilization_capital(tribal_cluster)
        
        # å»ºç«‹æ”¿æ²»ç»“æ„
        civilization.government = self._establish_government(tribal_cluster)
        
        # åˆå¹¶æŠ€æœ¯å’Œæ–‡åŒ–
        civilization.technology = self._merge_tribal_technologies(tribal_cluster)
        civilization.culture = self._merge_tribal_cultures(tribal_cluster)
        
        return civilization
```

#### **æ–‡æ˜ç±»è®¾è®¡**
```python
class Civilization:
    """æ–‡æ˜å®ä½“ç±»"""
    
    def __init__(self, founding_tribes: List[Tribe], formation_time: float):
        self.civilization_id = f"civ_{int(formation_time)}_{random.randint(1000, 9999)}"
        self.founding_tribes = founding_tribes
        self.formation_time = formation_time
        
        # æ–‡æ˜å±æ€§
        self.name = self._generate_civilization_name()
        self.capital = None  # é¦–éƒ½éƒ¨è½
        self.territory = self._calculate_total_territory()
        self.population = sum(len(tribe.members) for tribe in founding_tribes)
        
        # æ”¿æ²»ç³»ç»Ÿ
        self.government = None
        self.ruler = None
        self.political_stability = 0.5
        
        # ç»æµç³»ç»Ÿ
        self.economy = CivilizationEconomy()
        self.trade_networks = []
        self.resource_distribution = {}
        
        # æŠ€æœ¯ä¸æ–‡åŒ–
        self.technology = CivilizationTechnology()
        self.culture = CivilizationCulture()
        self.knowledge_level = self._calculate_initial_knowledge()
        
        # å†›äº‹ç³»ç»Ÿ
        self.military = CivilizationMilitary(founding_tribes)
        self.defensive_strength = self._calculate_defensive_strength()
        
        # å¤–äº¤å…³ç³»
        self.diplomatic_relations = {}  # ä¸å…¶ä»–æ–‡æ˜çš„å…³ç³»
        self.expansion_pressure = 0.3
        
    def update(self, dt: float, world_state: Dict):
        """æ–‡æ˜æ›´æ–°å¾ªç¯"""
        
        # 1. æ›´æ–°ç»„æˆéƒ¨è½
        for tribe in self.founding_tribes:
            tribe.update(dt, world_state)
        
        # 2. æ–‡æ˜çº§å†³ç­–
        civilization_decision = self._make_civilization_decision(world_state)
        
        # 3. æ‰§è¡Œæ–‡æ˜è¡ŒåŠ¨
        self._execute_civilization_action(civilization_decision)
        
        # 4. æ›´æ–°æ–‡æ˜å±æ€§
        self._update_civilization_state()
        
        # 5. å¤„ç†å†…æ”¿å’Œå¤–äº¤
        self._handle_internal_affairs()
        self._handle_foreign_relations(world_state)
    
    def _make_civilization_decision(self, world_state: Dict) -> CivilizationAction:
        """åˆ¶å®šæ–‡æ˜çº§å†³ç­–"""
        
        # è¯†åˆ«æ–‡æ˜é¢ä¸´çš„æŒ‘æˆ˜
        challenges = self._identify_civilization_challenges(world_state)
        
        if not challenges:
            return CivilizationAction(CivilizationActionType.MAINTAIN_STATUS_QUO)
        
        # é€‰æ‹©æœ€ç´§è¿«çš„æŒ‘æˆ˜
        primary_challenge = max(challenges.items(), key=lambda x: x[1])[0]
        
        # åŸºäºæ”¿åºœç±»å‹å’Œç»Ÿæ²»è€…ç‰¹å¾åˆ¶å®šå†³ç­–
        if primary_challenge == 'resource_scarcity':
            return self._decide_resource_strategy(world_state)
        elif primary_challenge == 'external_threat':
            return self._decide_military_strategy(world_state)
        elif primary_challenge == 'internal_conflict':
            return self._decide_political_strategy()
        elif primary_challenge == 'technological_lag':
            return self._decide_development_strategy()
        else:
            return CivilizationAction(CivilizationActionType.EXPLORE_AND_EXPAND)
    
    def _calculate_civilization_power(self) -> float:
        """è®¡ç®—æ–‡æ˜æ€»ä½“å®åŠ›"""
        
        # äººå£å®åŠ›
        population_power = self.population / 1000.0
        
        # ç»æµå®åŠ›
        economic_power = self.economy.calculate_gdp() / 10000.0
        
        # å†›äº‹å®åŠ›
        military_power = self.military.calculate_total_strength() / 5000.0
        
        # æŠ€æœ¯å®åŠ›
        tech_power = self.technology.calculate_tech_level() / 100.0
        
        # æ–‡åŒ–å®åŠ›
        cultural_power = self.culture.calculate_influence() / 100.0
        
        # æ”¿æ²»ç¨³å®šæ€§
        political_power = self.political_stability
        
        total_power = (population_power * 0.25 + 
                      economic_power * 0.2 + 
                      military_power * 0.2 + 
                      tech_power * 0.15 + 
                      cultural_power * 0.1 + 
                      political_power * 0.1)
        
        return total_power
```

---

## ğŸ® ç”¨æˆ·ç•Œé¢æ‰©å±•

### ğŸ“Š 1. å¤šå°ºåº¦å¯è§†åŒ–

#### **ç¼©æ”¾çº§åˆ«è®¾è®¡**
```python
class MultiScaleVisualization:
    """å¤šå°ºåº¦å¯è§†åŒ–ç³»ç»Ÿ"""
    
    def __init__(self):
        self.zoom_levels = {
            'individual': {
                'scale': 1.0,
                'min_zoom': 0.5,
                'max_zoom': 3.0,
                'focus': 'agent_detail'
            },
            'tribal': {
                'scale': 0.3,
                'min_zoom': 0.1,
                'max_zoom': 1.0,
                'focus': 'tribal_territory'
            },
            'civilization': {
                'scale': 0.05,
                'min_zoom': 0.01,
                'max_zoom': 0.2,
                'focus': 'civilization_map'
            },
            'world': {
                'scale': 0.01,
                'min_zoom': 0.001,
                'max_zoom': 0.05,
                'focus': 'global_overview'
            }
        }
        
        self.current_level = 'individual'
        self.transition_animation = None
    
    def render_current_scale(self, screen: pygame.Surface, world_state: Dict):
        """æ ¹æ®å½“å‰ç¼©æ”¾çº§åˆ«æ¸²æŸ“"""
        
        if self.current_level == 'individual':
            self._render_individual_view(screen, world_state)
        elif self.current_level == 'tribal':
            self._render_tribal_view(screen, world_state)
        elif self.current_level == 'civilization':
            self._render_civilization_view(screen, world_state)
        elif self.current_level == 'world':
            self._render_world_view(screen, world_state)
    
    def _render_tribal_view(self, screen: pygame.Surface, world_state: Dict):
        """æ¸²æŸ“éƒ¨è½çº§è§†å›¾"""
        
        tribes = world_state.get('tribes', [])
        
        for tribe in tribes:
            # ç»˜åˆ¶éƒ¨è½é¢†åœŸ
            territory_color = self._get_tribe_color(tribe)
            pygame.draw.circle(screen, territory_color, 
                             tribe.territory_center.to_pygame_coords(),
                             int(tribe.territory_radius * self.zoom_levels['tribal']['scale']))
            
            # ç»˜åˆ¶éƒ¨è½ä¸­å¿ƒ
            center_pos = tribe.territory_center.to_pygame_coords()
            pygame.draw.circle(screen, (255, 255, 255), center_pos, 5)
            
            # æ˜¾ç¤ºéƒ¨è½ä¿¡æ¯
            tribe_info = f"{tribe.name} ({len(tribe.members)})"
            font = pygame.font.Font(None, 24)
            text_surface = font.render(tribe_info, True, (255, 255, 255))
            screen.blit(text_surface, (center_pos[0] + 10, center_pos[1] - 10))
            
            # ç»˜åˆ¶éƒ¨è½é—´å…³ç³»çº¿
            self._draw_tribal_relations(screen, tribe, tribes)
    
    def _render_civilization_view(self, screen: pygame.Surface, world_state: Dict):
        """æ¸²æŸ“æ–‡æ˜çº§è§†å›¾"""
        
        civilizations = world_state.get('civilizations', [])
        
        for civilization in civilizations:
            # ç»˜åˆ¶æ–‡æ˜è¾¹ç•Œ
            civ_color = self._get_civilization_color(civilization)
            
            # ç»˜åˆ¶æ–‡æ˜é¢†åœŸï¼ˆç”±å¤šä¸ªéƒ¨è½é¢†åœŸç»„æˆï¼‰
            for tribe in civilization.founding_tribes:
                pygame.draw.circle(screen, civ_color + (100,),  # åŠé€æ˜
                                 tribe.territory_center.to_pygame_coords(),
                                 int(tribe.territory_radius * self.zoom_levels['civilization']['scale']))
            
            # ç»˜åˆ¶é¦–éƒ½
            if civilization.capital:
                capital_pos = civilization.capital.territory_center.to_pygame_coords()
                pygame.draw.circle(screen, (255, 215, 0), capital_pos, 8)  # é‡‘è‰²é¦–éƒ½
                
                # æ˜¾ç¤ºæ–‡æ˜ä¿¡æ¯
                civ_info = f"{civilization.name} (Pop: {civilization.population})"
                font = pygame.font.Font(None, 28)
                text_surface = font.render(civ_info, True, (255, 255, 255))
                screen.blit(text_surface, (capital_pos[0] + 15, capital_pos[1] - 15))
```

### ğŸ“ˆ 2. å¤šå±‚æ¬¡ç»Ÿè®¡é¢æ¿

#### **éƒ¨è½ç»Ÿè®¡é¢æ¿**
```python
class TribalStatsPanel:
    """éƒ¨è½ç»Ÿè®¡é¢æ¿"""
    
    def generate_tribal_stats_html(self, tribes: List[Tribe]) -> str:
        """ç”Ÿæˆéƒ¨è½ç»Ÿè®¡HTML"""
        
        html_content = f"""
        <div style="font-family: monospace; font-size: 11px; color: #E0E0E0;">
            <h3 style="color: #FF6B35;">ğŸ˜ï¸ éƒ¨è½ç»Ÿè®¡</h3>
            
            <div style="margin-bottom: 8px;">
                <span style="color: #4CAF50;">éƒ¨è½æ•°é‡:</span> {len(tribes)}<br>
                <span style="color: #2196F3;">æ€»äººå£:</span> {sum(len(t.members) for t in tribes)}<br>
                <span style="color: #FF9800;">å¹³å‡è§„æ¨¡:</span> {sum(len(t.members) for t in tribes) / len(tribes):.1f}<br>
            </div>
            
            <h4 style="color: #9C27B0;">æ´»è·ƒéƒ¨è½</h4>
            <div style="max-height: 120px; overflow-y: auto;">
        """
        
        # æŒ‰äººå£æ’åºæ˜¾ç¤ºå‰5ä¸ªéƒ¨è½
        sorted_tribes = sorted(tribes, key=lambda t: len(t.members), reverse=True)[:5]
        
        for i, tribe in enumerate(sorted_tribes):
            leader_name = f"Agent_{tribe.leader.agent_id[-4:]}"
            avg_energy = sum(m.energy for m in tribe.members) / len(tribe.members)
            
            energy_color = "#4CAF50" if avg_energy > 70 else "#FF9800" if avg_energy > 40 else "#F44336"
            
            html_content += f"""
                <div style="margin: 2px 0; padding: 2px; background: rgba(255,255,255,0.1);">
                    <span style="color: #FFC107;">#{i+1}</span>
                    <span style="color: #E91E63;">ğŸ‘‘{leader_name}</span><br>
                    <span style="color: #03DAC6;">äººå£: {len(tribe.members)}</span>
                    <span style="color: {energy_color};">èƒ½é‡: {avg_energy:.0f}</span>
                </div>
            """
        
        html_content += """
            </div>
        </div>
        """
        
        return html_content
```

---

## ğŸš€ å®ç°è·¯çº¿å›¾

### ğŸ“… åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

#### **é˜¶æ®µ1: éƒ¨è½åŸºç¡€ (2-3å‘¨)**
```python
# ä¼˜å…ˆå®ç°çš„æ ¸å¿ƒåŠŸèƒ½
PHASE_1_FEATURES = [
    "TribalFormation",           # éƒ¨è½å½¢æˆæœºåˆ¶
    "Tribe",                     # åŸºç¡€éƒ¨è½ç±»
    "CollectiveDecisionMaker",   # é›†ä½“å†³ç­–
    "TribalStatsPanel",          # éƒ¨è½ç»Ÿè®¡é¢æ¿
    "MultiScaleVisualization"    # å¤šå°ºåº¦å¯è§†åŒ–åŸºç¡€
]

# å®ç°é¡ºåº
implementation_order = [
    "1. æ‰©å±•ç°æœ‰Agentç±»ï¼Œæ·»åŠ tribal_affiliationå±æ€§",
    "2. å®ç°TribalFormation.detect_potential_tribes()",
    "3. åˆ›å»ºåŸºç¡€Tribeç±»å’Œæˆå‘˜ç®¡ç†",
    "4. æ·»åŠ éƒ¨è½å¯è§†åŒ–åˆ°ç°æœ‰GUI",
    "5. å®ç°ç®€å•çš„é›†ä½“å†³ç­–æœºåˆ¶",
    "6. æµ‹è¯•éƒ¨è½å½¢æˆå’ŒåŸºæœ¬åŠŸèƒ½"
]
```

#### **é˜¶æ®µ2: éƒ¨è½äº’åŠ¨ (3-4å‘¨)**
```python
PHASE_2_FEATURES = [
    "InterTribalRelations",      # éƒ¨è½é—´å…³ç³»
    "TribalConflictSystem",      # å†²çªç³»ç»Ÿ
    "TradeSystem",               # è´¸æ˜“ç³»ç»Ÿ
    "TerritorialManagement",     # é¢†åœŸç®¡ç†
    "AdvancedTribalAI"          # é«˜çº§éƒ¨è½AI
]
```

#### **é˜¶æ®µ3: æ–‡æ˜æ¶Œç° (4-5å‘¨)**
```python
PHASE_3_FEATURES = [
    "CivilizationEmergence",     # æ–‡æ˜æ¶Œç°æ£€æµ‹
    "Civilization",              # æ–‡æ˜ç±»
    "CivilizationGovernment",    # æ”¿æ²»ç³»ç»Ÿ
    "CivilizationEconomy",       # ç»æµç³»ç»Ÿ
    "DiplomaticSystem"           # å¤–äº¤ç³»ç»Ÿ
]
```

### ğŸ”§ æŠ€æœ¯å®ç°å»ºè®®

#### **1. å‘åå…¼å®¹æ€§**
```python
# ä¿æŒç°æœ‰APIå…¼å®¹
class SimpleAgent:
    def __init__(self, config: Dict):
        # ç°æœ‰åˆå§‹åŒ–ä»£ç 
        self.tribal_affiliation = None  # æ–°å¢éƒ¨è½å½’å±
        self.tribal_role = None         # æ–°å¢éƒ¨è½è§’è‰²
        
    def update(self, dt: float, world_state: Dict, nearby_agents: List, nearby_resources: List):
        # ç°æœ‰æ›´æ–°é€»è¾‘
        
        # æ–°å¢éƒ¨è½è¡Œä¸º
        if self.tribal_affiliation:
            self._update_tribal_behavior(dt, world_state)
```

#### **2. é…ç½®æ‰©å±•**
```python
# æ‰©å±•é…ç½®ç³»ç»Ÿ
TRIBAL_CONFIG = {
    'tribal_formation': {
        'enabled': True,
        'min_tribe_size': 5,
        'max_tribe_size': 50,
        'formation_probability': 0.1,
        'leadership_selection': 'merit_based'  # 'random', 'age_based', 'merit_based'
    },
    
    'inter_tribal': {
        'enabled': True,
        'interaction_range_multiplier': 2.0,
        'conflict_probability': 0.05,
        'trade_probability': 0.3,
        'alliance_probability': 0.1
    },
    
    'civilization': {
        'enabled': False,  # é»˜è®¤å…³é—­ï¼Œéœ€è¦æ‰‹åŠ¨å¯ç”¨
        'min_tribes_for_civilization': 3,
        'emergence_check_interval': 100
    }
}
```

è¿™ä¸ªæ‰©å±•æ–¹æ¡ˆé‡‡ç”¨æ¸è¿›å¼è®¾è®¡ï¼Œå¯ä»¥åœ¨ä¸ç ´åç°æœ‰ç³»ç»Ÿçš„åŸºç¡€ä¸Šï¼Œé€æ­¥æ·»åŠ éƒ¨è½å’Œæ–‡æ˜åŠŸèƒ½ã€‚ä½ è§‰å¾—è¿™ä¸ªæ–¹å‘å¦‚ä½•ï¼Ÿéœ€è¦æˆ‘è¯¦ç»†å®ç°å…¶ä¸­çš„æŸä¸ªéƒ¨åˆ†å—ï¼Ÿ